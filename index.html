<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>A Tidymodels Interface for the midr Package • midnight</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
<link rel="icon" sizes="any" href="favicon.ico">
<link rel="manifest" href="site.webmanifest">
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="A Tidymodels Interface for the midr Package">
<meta name="description" content='The midnight package implements a parsnip engine for the midr package, allowing users to seamlessly fit, tune, and evaluate MID (Maximum Interpretation Decomposition) models with tidymodels workflows. Development and augmentation of the package are driven by research from the "Moonlight Seminar 2025", a collaborative study group of actuaries from the Institute of Actuaries of Japan focused on advancing the practical applications of interpretable models.'>
<meta property="og:description" content='The midnight package implements a parsnip engine for the midr package, allowing users to seamlessly fit, tune, and evaluate MID (Maximum Interpretation Decomposition) models with tidymodels workflows. Development and augmentation of the package are driven by research from the "Moonlight Seminar 2025", a collaborative study group of actuaries from the Institute of Actuaries of Japan focused on advancing the practical applications of interpretable models.'>
<meta property="og:image" content="https://ryo-asashi.github.io/midnight/logo.png">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">midnight</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0.901</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ryo-asashi/midnight/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header">
<img src="logo.png" class="logo" alt=""><h1 id="midnight-">midnight <a class="anchor" aria-label="anchor" href="#midnight-"></a>
</h1>
</div>
<!-- badges: start -->
<!-- badges: end -->
<p>The ‘midnight’ package implements a ‘parsnip’ engine for the ‘midr’ package, allowing users to seamlessly fit, tune, and evaluate MID (Maximum Interpretation Decomposition) models with ‘tidymodels’ workflows. Development and augmentation of the package are driven by research from the “Moonlight Seminar 2025”, a collaborative study group of actuaries from the Institute of Actuaries of Japan focused on advancing the practical applications of interpretable models.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the development version of midnight from <a href="https://github.com/" class="external-link">GitHub</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("pak")</span></span>
<span><span class="fu">pak</span><span class="fu">::</span><span class="fu"><a href="https://pak.r-lib.org/reference/pak.html" class="external-link">pak</a></span><span class="op">(</span><span class="st">"ryo-asashi/midnight"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="fit-mid-surrogate-models-using-parsnip">Fit MID Surrogate Models using ‘parsnip’<a class="anchor" aria-label="anchor" href="#fit-mid-surrogate-models-using-parsnip"></a>
</h2>
<p>This is a basic example which shows you how to solve a common problem:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/parsnip" class="external-link">parsnip</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ryo-asashi/midr" class="external-link">midr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ryo-asashi/midnight" class="external-link">midnight</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://codeberg.org/tesselle/khroma" class="external-link">khroma</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">gridExtra</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html" class="external-link">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ryo-asashi.github.io/midr/reference/theme_midr.html" class="external-link">theme_midr</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># create a first-order mid surrogate model</span></span>
<span><span class="va">mid_spec_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/mid_surrogate.html">mid_surrogate</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_args.html" class="external-link">set_mode</a></span><span class="op">(</span><span class="st">"regression"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_engine.html" class="external-link">set_engine</a></span><span class="op">(</span><span class="st">"midr"</span>, verbosity <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">mid_spec_1</span></span>
<span><span class="co">#&gt; mid surrogate Model Specification (regression)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Engine-Specific Arguments:</span></span>
<span><span class="co">#&gt;   verbosity = 3</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Computational engine: midr</span></span>
<span><span class="co"># fit the model</span></span>
<span><span class="va">mid_1</span> <span class="op">&lt;-</span> <span class="va">mid_spec_1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://generics.r-lib.org/reference/fit_xy.html" class="external-link">fit_xy</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">airquality</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span>, y <span class="op">=</span> <span class="va">airquality</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">mid_1</span></span>
<span><span class="co">#&gt; parsnip model object</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; interpret(x = x, y = y, weights = weights, k = k, lambda = penalty,</span></span>
<span><span class="co">#&gt;  verbosity = ..1)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Intercept: 42.099</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Main Effects:</span></span>
<span><span class="co">#&gt; 5 main effect terms</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Uninterpreted Variation Ratio: 0.028441</span></span>
<span><span class="co"># create a second-order mid surrogate model via "custom formula"</span></span>
<span><span class="va">mid_spec_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/mid_surrogate.html">mid_surrogate</a></span><span class="op">(</span></span>
<span>  params_main <span class="op">=</span> <span class="fl">50</span>, params_inter <span class="op">=</span> <span class="fl">5</span>, penalty <span class="op">=</span> <span class="fl">.9</span>,</span>
<span>  custom_formula <span class="op">=</span> <span class="va">Ozone</span> <span class="op">~</span> <span class="va">.</span><span class="op">^</span><span class="fl">2</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_args.html" class="external-link">set_mode</a></span><span class="op">(</span><span class="st">"regression"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_engine.html" class="external-link">set_engine</a></span><span class="op">(</span><span class="st">"midr"</span>, verbosity <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co"># fit the model</span></span>
<span><span class="va">mid_2</span> <span class="op">&lt;-</span> <span class="va">mid_spec_2</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://generics.r-lib.org/reference/fit_xy.html" class="external-link">fit_xy</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">airquality</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span>, y <span class="op">=</span> <span class="va">airquality</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">mid_2</span></span>
<span><span class="co">#&gt; parsnip model object</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; interpret(formula = Ozone ~ .^2, data = data, weights = weights,</span></span>
<span><span class="co">#&gt;  verbosity = ..1, k = k, lambda = penalty)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Intercept: 42.099</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Main Effects:</span></span>
<span><span class="co">#&gt; 5 main effect terms</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Interactions:</span></span>
<span><span class="co">#&gt; 10 interaction terms</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Uninterpreted Variation Ratio: 0.073086</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">grid.arrange</span><span class="op">(</span>nrow <span class="op">=</span> <span class="fl">2</span>,</span>
<span> <span class="fu"><a href="https://ryo-asashi.github.io/midr/reference/ggmid.html" class="external-link">ggmid</a></span><span class="op">(</span><span class="fu"><a href="https://ryo-asashi.github.io/midr/reference/mid.importance.html" class="external-link">mid.importance</a></span><span class="op">(</span><span class="va">mid_2</span><span class="op">$</span><span class="va">fit</span><span class="op">)</span>, theme <span class="op">=</span> <span class="st">"muted"</span><span class="op">)</span>,</span>
<span> <span class="fu"><a href="https://ryo-asashi.github.io/midr/reference/ggmid.html" class="external-link">ggmid</a></span><span class="op">(</span><span class="va">mid_2</span><span class="op">$</span><span class="va">fit</span>, <span class="st">"Temp"</span>, main.effects <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span> <span class="fu"><a href="https://ryo-asashi.github.io/midr/reference/ggmid.html" class="external-link">ggmid</a></span><span class="op">(</span><span class="va">mid_2</span><span class="op">$</span><span class="va">fit</span>, <span class="st">"Wind"</span>, main.effects <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span> <span class="fu"><a href="https://ryo-asashi.github.io/midr/reference/ggmid.html" class="external-link">ggmid</a></span><span class="op">(</span><span class="va">mid_2</span><span class="op">$</span><span class="va">fit</span>, <span class="st">"Temp:Wind"</span>, main.effects <span class="op">=</span> <span class="cn">TRUE</span>, theme <span class="op">=</span> <span class="st">"tokyo"</span><span class="op">)</span> </span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-2-1.png" width="100%"></p>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/ryo-asashi/midnight/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/ryo-asashi/midnight/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing midnight</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Ryoichi Asasihba <br><small class="roles"> Author, maintainer </small>   </li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Ryoichi Asasihba.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
