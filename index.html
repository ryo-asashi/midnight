<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>A Tidymodels Interface for the midr Package • midnight</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
<link rel="icon" sizes="any" href="favicon.ico">
<link rel="manifest" href="site.webmanifest">
<script src="lightswitch.js"></script><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="A Tidymodels Interface for the midr Package">
<meta name="description" content='The midnight package implements a parsnip engine for the midr package, allowing users to seamlessly fit, tune, and evaluate MID (Maximum Interpretation Decomposition) models with tidymodels workflows. Development and augmentation of the package are driven by research from the "Moonlight Seminar 2025", a collaborative study group of actuaries from the Institute of Actuaries of Japan focused on advancing the practical applications of interpretable models.'>
<meta property="og:description" content='The midnight package implements a parsnip engine for the midr package, allowing users to seamlessly fit, tune, and evaluate MID (Maximum Interpretation Decomposition) models with tidymodels workflows. Development and augmentation of the package are driven by research from the "Moonlight Seminar 2025", a collaborative study group of actuaries from the Institute of Actuaries of Japan focused on advancing the practical applications of interpretable models.'>
<meta property="og:image" content="https://ryo-asashi.github.io/midnight/logo.png">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">midnight</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0.904</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ryo-asashi/midnight/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header">
<img src="logo.png" class="logo" alt=""><h1 id="midnight-">midnight <a class="anchor" aria-label="anchor" href="#midnight-"></a>
</h1>
</div>
<!-- badges: start -->
<!-- badges: end -->
<p>The ‘midnight’ package implements a ‘parsnip’ engine for the ‘midr’ package, allowing users to seamlessly fit, tune, and evaluate MID (Maximum Interpretation Decomposition) models with ‘tidymodels’ workflows. Development and augmentation of the package are driven by research from the “Moonlight Seminar 2025”, a collaborative study group of actuaries from the Institute of Actuaries of Japan focused on advancing the practical applications of interpretable models.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the development version of midnight from <a href="https://github.com/" class="external-link">GitHub</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("pak")</span></span>
<span><span class="fu">pak</span><span class="fu">::</span><span class="fu"><a href="https://pak.r-lib.org/reference/pak.html" class="external-link">pak</a></span><span class="op">(</span><span class="st">"ryo-asashi/midnight"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="fit-mid-surrogate-models-using-parsnip">Fit MID Surrogate Models using ‘parsnip’<a class="anchor" aria-label="anchor" href="#fit-mid-surrogate-models-using-parsnip"></a>
</h2>
<p>This is a basic example which shows you how to solve a common problem:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidymodels.tidymodels.org" class="external-link">tidymodels</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ryo-asashi/midr" class="external-link">midr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ryo-asashi/midnight" class="external-link">midnight</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">gridExtra</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://www.statlearning.com" class="external-link">ISLR2</a></span><span class="op">)</span></span>
<span><span class="fu">theme_set</span><span class="op">(</span><span class="fu"><a href="https://ryo-asashi.github.io/midr/reference/theme_midr.html" class="external-link">theme_midr</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># split dataset into training / validating subsets</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="va">usecol</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mnth"</span>, <span class="st">"hr"</span>, <span class="st">"workingday"</span>, <span class="st">"weathersit"</span>,</span>
<span>            <span class="st">"temp"</span>, <span class="st">"hum"</span>, <span class="st">"windspeed"</span>, <span class="st">"bikers"</span><span class="op">)</span></span>
<span><span class="va">all</span> <span class="op">&lt;-</span> <span class="fu">ISLR2</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/ISLR2/man/Bikeshare.html" class="external-link">Bikeshare</a></span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="fu">all_of</span><span class="op">(</span><span class="va">usecol</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>workingday <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">workingday</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">holdout</span> <span class="op">&lt;-</span> <span class="fu">initial_split</span><span class="op">(</span><span class="va">all</span>, prop <span class="op">=</span> <span class="fl">.5</span><span class="op">)</span></span>
<span><span class="va">train</span> <span class="op">&lt;-</span> <span class="fu">training</span><span class="op">(</span><span class="va">holdout</span><span class="op">)</span></span>
<span><span class="va">valid</span> <span class="op">&lt;-</span> <span class="fu">testing</span><span class="op">(</span><span class="va">holdout</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create a first-order mid surrogate model</span></span>
<span><span class="va">mid_spec_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/mid_surrogate.html">mid_surrogate</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">set_mode</span><span class="op">(</span><span class="st">"regression"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">set_engine</span><span class="op">(</span><span class="st">"midr"</span><span class="op">)</span></span>
<span><span class="va">mid_spec_1</span></span>
<span><span class="co">#&gt; mid surrogate Model Specification (regression)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Computational engine: midr</span></span>
<span><span class="co"># fit the model</span></span>
<span><span class="va">mid_1</span> <span class="op">&lt;-</span> <span class="va">mid_spec_1</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">fit</span><span class="op">(</span><span class="va">bikers</span> <span class="op">~</span> <span class="va">.</span>, <span class="va">train</span><span class="op">)</span></span>
<span><span class="va">mid_1</span></span>
<span><span class="co">#&gt; parsnip model object</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; interpret(x = x, y = y, weights = weights, k = k, lambda = penalty)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Intercept: 146.06</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Main Effects:</span></span>
<span><span class="co">#&gt; 7 main effect terms</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Uninterpreted Variation Ratio: 0.30041</span></span>
<span><span class="co"># evaluate the model</span></span>
<span><span class="fu">augment</span><span class="op">(</span><span class="va">mid_1</span>, new_data <span class="op">=</span> <span class="va">valid</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">rmse</span><span class="op">(</span>truth <span class="op">=</span> <span class="va">bikers</span>, estimate <span class="op">=</span> <span class="va">.pred</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1 × 3</span></span>
<span><span class="co">#&gt;   .metric .estimator .estimate</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 rmse    standard        72.9</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">grid.arrange</span><span class="op">(</span>nrow <span class="op">=</span> <span class="fl">2</span>,</span>
<span> <span class="fu"><a href="https://ryo-asashi.github.io/midr/reference/ggmid.html" class="external-link">ggmid</a></span><span class="op">(</span><span class="fu"><a href="https://ryo-asashi.github.io/midr/reference/mid.importance.html" class="external-link">mid.importance</a></span><span class="op">(</span><span class="va">mid_1</span><span class="op">$</span><span class="va">fit</span><span class="op">)</span>, theme <span class="op">=</span> <span class="st">"moon"</span>, max.nterms <span class="op">=</span> <span class="fl">15</span><span class="op">)</span>,</span>
<span> <span class="fu"><a href="https://ryo-asashi.github.io/midr/reference/ggmid.html" class="external-link">ggmid</a></span><span class="op">(</span><span class="va">mid_1</span><span class="op">$</span><span class="va">fit</span>, <span class="st">"hr"</span><span class="op">)</span>,</span>
<span> <span class="fu"><a href="https://ryo-asashi.github.io/midr/reference/ggmid.html" class="external-link">ggmid</a></span><span class="op">(</span><span class="va">mid_1</span><span class="op">$</span><span class="va">fit</span>, <span class="st">"temp"</span><span class="op">)</span>,</span>
<span> <span class="fu"><a href="https://ryo-asashi.github.io/midr/reference/ggmid.html" class="external-link">ggmid</a></span><span class="op">(</span><span class="va">mid_1</span><span class="op">$</span><span class="va">fit</span>, <span class="st">"mnth"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-ggmid_1d_fit-1.png" width="100%"></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create a second-order mid surrogate model via "custom formula"</span></span>
<span><span class="va">mid_spec_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/mid_surrogate.html">mid_surrogate</a></span><span class="op">(</span></span>
<span>  penalty <span class="op">=</span> <span class="fl">0.000001</span>, custom_formula <span class="op">=</span> <span class="va">bikers</span> <span class="op">~</span> <span class="va">.</span><span class="op">^</span><span class="fl">2</span></span>
<span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">set_mode</span><span class="op">(</span><span class="st">"regression"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">set_engine</span><span class="op">(</span><span class="st">"midr"</span><span class="op">)</span></span>
<span><span class="va">mid_spec_2</span></span>
<span><span class="co">#&gt; mid surrogate Model Specification (regression)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Main Arguments:</span></span>
<span><span class="co">#&gt;   penalty = 1e-06</span></span>
<span><span class="co">#&gt;   custom_formula = bikers ~ .^2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Computational engine: midr</span></span>
<span><span class="co"># fit the model</span></span>
<span><span class="va">mid_2</span> <span class="op">&lt;-</span> <span class="va">mid_spec_2</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">fit</span><span class="op">(</span><span class="va">bikers</span> <span class="op">~</span> <span class="va">.</span>, <span class="va">train</span><span class="op">)</span> <span class="co"># pass original data on to interpret()</span></span>
<span><span class="va">mid_2</span></span>
<span><span class="co">#&gt; parsnip model object</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; interpret(formula = bikers ~ .^2, data = data, weights = weights,</span></span>
<span><span class="co">#&gt;  k = k, lambda = penalty)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Intercept: 146.06</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Main Effects:</span></span>
<span><span class="co">#&gt; 7 main effect terms</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Interactions:</span></span>
<span><span class="co">#&gt; 21 interaction terms</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Uninterpreted Variation Ratio: 0.069436</span></span>
<span><span class="co"># evaluate the model</span></span>
<span><span class="fu">augment</span><span class="op">(</span><span class="va">mid_2</span>, new_data <span class="op">=</span> <span class="va">valid</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">rmse</span><span class="op">(</span>truth <span class="op">=</span> <span class="va">bikers</span>, estimate <span class="op">=</span> <span class="va">.pred</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1 × 3</span></span>
<span><span class="co">#&gt;   .metric .estimator .estimate</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 rmse    standard        44.3</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">grid.arrange</span><span class="op">(</span>nrow <span class="op">=</span> <span class="fl">2</span>,</span>
<span> <span class="fu"><a href="https://ryo-asashi.github.io/midr/reference/ggmid.html" class="external-link">ggmid</a></span><span class="op">(</span><span class="fu"><a href="https://ryo-asashi.github.io/midr/reference/mid.importance.html" class="external-link">mid.importance</a></span><span class="op">(</span><span class="va">mid_2</span><span class="op">$</span><span class="va">fit</span><span class="op">)</span>, theme <span class="op">=</span> <span class="st">"moon"</span>, max.nterms <span class="op">=</span> <span class="fl">15</span><span class="op">)</span>,</span>
<span> <span class="fu"><a href="https://ryo-asashi.github.io/midr/reference/ggmid.html" class="external-link">ggmid</a></span><span class="op">(</span><span class="va">mid_2</span><span class="op">$</span><span class="va">fit</span>, <span class="st">"hr"</span><span class="op">)</span>,</span>
<span> <span class="fu"><a href="https://ryo-asashi.github.io/midr/reference/ggmid.html" class="external-link">ggmid</a></span><span class="op">(</span><span class="va">mid_2</span><span class="op">$</span><span class="va">fit</span>, <span class="st">"temp"</span><span class="op">)</span>,</span>
<span> <span class="fu"><a href="https://ryo-asashi.github.io/midr/reference/ggmid.html" class="external-link">ggmid</a></span><span class="op">(</span><span class="va">mid_2</span><span class="op">$</span><span class="va">fit</span>, <span class="st">"hr:workingday"</span>, type <span class="op">=</span> <span class="st">"data"</span>, data <span class="op">=</span> <span class="va">valid</span>,</span>
<span>       main.effects <span class="op">=</span> <span class="cn">TRUE</span>, theme <span class="op">=</span> <span class="st">"moonlit"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-ggmid_2d_fit-1.png" width="100%"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ryo-asashi.github.io/midr/reference/theme_midr.html" class="external-link">par.midr</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/persp.html" class="external-link">persp</a></span><span class="op">(</span><span class="va">mid_2</span><span class="op">$</span><span class="va">fit</span>, <span class="st">"temp:hr"</span>, theta <span class="op">=</span> <span class="fl">50</span>, phi <span class="op">=</span> <span class="fl">20</span>, shade <span class="op">=</span> <span class="fl">.5</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-persp_mid-1.png" width="100%"></p>
</div>
<div class="section level2">
<h2 id="tune-mid-surrogate-models-using-tune">Tune MID Surrogate Models using ‘tune’<a class="anchor" aria-label="anchor" href="#tune-mid-surrogate-models-using-tune"></a>
</h2>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create a second-order mid surrogate model via "custom formula"</span></span>
<span><span class="va">mid_spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/mid_surrogate.html">mid_surrogate</a></span><span class="op">(</span></span>
<span>  params_main <span class="op">=</span> <span class="fu">tune</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  params_inter <span class="op">=</span> <span class="fu">tune</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  penalty <span class="op">=</span> <span class="fu">tune</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  custom_formula <span class="op">=</span> <span class="va">bikers</span> <span class="op">~</span> <span class="va">.</span><span class="op">^</span><span class="fl">2</span></span>
<span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">set_mode</span><span class="op">(</span><span class="st">"regression"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">set_engine</span><span class="op">(</span><span class="st">"midr"</span>, verbosity <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">mid_spec</span></span>
<span><span class="co">#&gt; mid surrogate Model Specification (regression)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Main Arguments:</span></span>
<span><span class="co">#&gt;   penalty = tune()</span></span>
<span><span class="co">#&gt;   params_main = tune()</span></span>
<span><span class="co">#&gt;   params_inter = tune()</span></span>
<span><span class="co">#&gt;   custom_formula = bikers ~ .^2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Engine-Specific Arguments:</span></span>
<span><span class="co">#&gt;   verbosity = 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Computational engine: midr</span></span>
<span><span class="co"># define a cross validation method</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="va">cv</span> <span class="op">&lt;-</span> <span class="fu">vfold_cv</span><span class="op">(</span><span class="va">train</span>, v <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co"># execute the hyperparameter tuning</span></span>
<span><span class="va">tune_res</span> <span class="op">&lt;-</span> <span class="va">mid_spec</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">tune_bayes</span><span class="op">(</span></span>
<span>    <span class="va">bikers</span> <span class="op">~</span> <span class="va">.</span>,</span>
<span>    resamples <span class="op">=</span> <span class="va">cv</span>,</span>
<span>    iter <span class="op">=</span> <span class="fl">50</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">tune_best</span> <span class="op">&lt;-</span> <span class="fu">select_best</span><span class="op">(</span><span class="va">tune_res</span>, metric <span class="op">=</span> <span class="st">"rmse"</span><span class="op">)</span></span>
<span><span class="va">tune_best</span></span>
<span><span class="co">#&gt; # A tibble: 1 × 4</span></span>
<span><span class="co">#&gt;   penalty params_main params_inter .config</span></span>
<span><span class="co">#&gt;     &lt;dbl&gt;       &lt;int&gt;        &lt;int&gt; &lt;chr&gt;  </span></span>
<span><span class="co">#&gt; 1   0.668          70            5 Iter23</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create a second-order mid surrogate model via "custom formula"</span></span>
<span><span class="va">mid_spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/mid_surrogate.html">mid_surrogate</a></span><span class="op">(</span></span>
<span>  params_main <span class="op">=</span> <span class="va">tune_best</span><span class="op">$</span><span class="va">params_main</span>,</span>
<span>  params_inter <span class="op">=</span> <span class="va">tune_best</span><span class="op">$</span><span class="va">params_inter</span>,</span>
<span>  penalty <span class="op">=</span> <span class="va">tune_best</span><span class="op">$</span><span class="va">penalty</span>,</span>
<span>  custom_formula <span class="op">=</span> <span class="va">bikers</span> <span class="op">~</span> <span class="va">.</span><span class="op">^</span><span class="fl">2</span></span>
<span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">set_mode</span><span class="op">(</span><span class="st">"regression"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">set_engine</span><span class="op">(</span><span class="st">"midr"</span>, verbosity <span class="op">=</span> <span class="fl">0</span>, singular.ok <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">mid_spec</span></span>
<span><span class="co">#&gt; mid surrogate Model Specification (regression)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Main Arguments:</span></span>
<span><span class="co">#&gt;   penalty = tune_best$penalty</span></span>
<span><span class="co">#&gt;   params_main = tune_best$params_main</span></span>
<span><span class="co">#&gt;   params_inter = tune_best$params_inter</span></span>
<span><span class="co">#&gt;   custom_formula = bikers ~ .^2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Engine-Specific Arguments:</span></span>
<span><span class="co">#&gt;   verbosity = 0</span></span>
<span><span class="co">#&gt;   singular.ok = TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Computational engine: midr</span></span>
<span><span class="co"># fit the model</span></span>
<span><span class="va">mid_tune</span> <span class="op">&lt;-</span> <span class="va">mid_spec</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">fit</span><span class="op">(</span><span class="va">bikers</span> <span class="op">~</span> <span class="va">.</span>, <span class="va">train</span><span class="op">)</span> <span class="co"># pass original data on to interpret()</span></span>
<span><span class="va">mid_tune</span></span>
<span><span class="co">#&gt; parsnip model object</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; interpret(formula = bikers ~ .^2, data = data, weights = weights,</span></span>
<span><span class="co">#&gt;  verbosity = ..1, k = k, lambda = penalty, singular.ok = ..2)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Intercept: 146.06</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Main Effects:</span></span>
<span><span class="co">#&gt; 7 main effect terms</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Interactions:</span></span>
<span><span class="co">#&gt; 21 interaction terms</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Uninterpreted Variation Ratio: 0.080808</span></span>
<span><span class="co"># evaluate the model</span></span>
<span><span class="fu">augment</span><span class="op">(</span><span class="va">mid_tune</span>, new_data <span class="op">=</span> <span class="va">valid</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">rmse</span><span class="op">(</span>truth <span class="op">=</span> <span class="va">bikers</span>, estimate <span class="op">=</span> <span class="va">.pred</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1 × 3</span></span>
<span><span class="co">#&gt;   .metric .estimator .estimate</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 rmse    standard        43.0</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">grid.arrange</span><span class="op">(</span>nrow <span class="op">=</span> <span class="fl">2</span>,</span>
<span> <span class="fu"><a href="https://ryo-asashi.github.io/midr/reference/ggmid.html" class="external-link">ggmid</a></span><span class="op">(</span><span class="fu"><a href="https://ryo-asashi.github.io/midr/reference/mid.importance.html" class="external-link">mid.importance</a></span><span class="op">(</span><span class="va">mid_tune</span><span class="op">$</span><span class="va">fit</span><span class="op">)</span>, theme <span class="op">=</span> <span class="st">"moon"</span>, max.nterms <span class="op">=</span> <span class="fl">15</span><span class="op">)</span>,</span>
<span> <span class="fu"><a href="https://ryo-asashi.github.io/midr/reference/ggmid.html" class="external-link">ggmid</a></span><span class="op">(</span><span class="va">mid_tune</span><span class="op">$</span><span class="va">fit</span>, <span class="st">"hr"</span><span class="op">)</span>,</span>
<span> <span class="fu"><a href="https://ryo-asashi.github.io/midr/reference/ggmid.html" class="external-link">ggmid</a></span><span class="op">(</span><span class="va">mid_tune</span><span class="op">$</span><span class="va">fit</span>, <span class="st">"temp"</span><span class="op">)</span>,</span>
<span> <span class="fu"><a href="https://ryo-asashi.github.io/midr/reference/ggmid.html" class="external-link">ggmid</a></span><span class="op">(</span><span class="va">mid_tune</span><span class="op">$</span><span class="va">fit</span>, <span class="st">"hr:workingday"</span>, type <span class="op">=</span> <span class="st">"data"</span>, data <span class="op">=</span> <span class="va">valid</span>,</span>
<span>       main.effects <span class="op">=</span> <span class="cn">TRUE</span>, theme <span class="op">=</span> <span class="st">"moonlit"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-ggmid_tune_fit-1.png" width="100%"></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ryo-asashi.github.io/midr/reference/theme_midr.html" class="external-link">par.midr</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/persp.html" class="external-link">persp</a></span><span class="op">(</span><span class="va">mid_tune</span><span class="op">$</span><span class="va">fit</span>, <span class="st">"temp:hr"</span>, theta <span class="op">=</span> <span class="fl">50</span>, phi <span class="op">=</span> <span class="fl">20</span>, shade <span class="op">=</span> <span class="fl">.5</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-persp_tuned_mid-1.png" width="100%"></p>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/ryo-asashi/midnight/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/ryo-asashi/midnight/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing midnight</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Ryoichi Asashiba <br><small class="roles"> Author, maintainer </small>   </li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Ryoichi Asashiba.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
